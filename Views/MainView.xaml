<Window x:Class="CollisionControl.MainView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:CollisionControl"
        mc:Ignorable="d" 
             Height="600" 
        MinHeight="600"
             Width="1300"
        MinWidth="1300"
             Title="Контроль коллизий">
    <Window.Resources>
        <Style x:Key="ButtonStyle" TargetType="{x:Type Button}">
            <Setter Property="Button.BorderBrush">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,1" EndPoint="1,0" SpreadMethod="Pad" Opacity="1">
                        <GradientStop Color="#FF233C91" Offset="0.6" />
                        <GradientStop Color="#FFB455A0" Offset="1" />
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>
        <Style x:Key="ComboBoxStyle" TargetType="ComboBox">
            <Style.Setters>
                <Setter Property="BorderBrush" Value="MediumPurple"/>
                <Setter Property="BorderThickness" Value="2"/>
            </Style.Setters>
        </Style>
        <Style x:Key="WindowStyle" TargetType="{x:Type Window}">
            <Setter Property="Window.BorderBrush">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,1" EndPoint="1,0" SpreadMethod="Pad" Opacity="1">
                        <GradientStop Color="#FF233C91" Offset="0.6" />
                        <GradientStop Color="#FFB455A0" Offset="1" />
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>
        <Style x:Key="ListBoxItemStyle" TargetType="ListBoxItem" BasedOn="{StaticResource {x:Type ListBoxItem}}">
            <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="Bd"  BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="true">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background">
                                    <Setter.Value>
                                        <SolidColorBrush Color="#FF233C91" Opacity="0.2"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,1" EndPoint="1,0" SpreadMethod="Pad" Opacity="0.5">
                                            <GradientStop Color="#FF233C91" Offset="0.6" />
                                            <GradientStop Color="#FFB455A0" Offset="1" />
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="BorderBrush">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,1" EndPoint="1,0" SpreadMethod="Pad" Opacity="1">
                                            <GradientStop Color="#FF233C91" Offset="0.6" />
                                            <GradientStop Color="#FFB455A0" Offset="1" />
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" MinHeight="50"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*" MinHeight="50"/>
            <RowDefinition Height="62"/>
            <RowDefinition Height="40"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" MinWidth="150"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*" MinWidth="645"/>
        </Grid.ColumnDefinitions>
        <GridSplitter 
                      Grid.Row="1"
            ShowsPreview="False" 
            Height="5"
            VerticalAlignment="Center"
            HorizontalAlignment="Stretch">
            <GridSplitter.Background>
                <SolidColorBrush Color="#FF233C91" Opacity="0.5"/>
            </GridSplitter.Background>

        </GridSplitter>
        <GridSplitter 
                      Grid.Column="1"
            Grid.RowSpan="4"
            ShowsPreview="False" 
            Width="5"
            VerticalAlignment="Stretch"
            HorizontalAlignment="Center">
            <GridSplitter.Background>
                <SolidColorBrush Color="#FF233C91" Opacity="0.5"/>
            </GridSplitter.Background>

        </GridSplitter>
        <!--ПРОВЕРКИ-->
        <GroupBox 
                   Grid.Row="2"
                   Margin="2">
            <GroupBox.Header>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="ПРОВЕРКИ."></TextBlock>
                    <TextBlock Text="{Binding CountClashsSelected, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay, StringFormat='выделено: {0} из'}"/>
                    <TextBlock Text="{Binding CountClashs, StringFormat=' {0} шт.'}"/>
                </StackPanel>
            </GroupBox.Header>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition Height="35"/>
                </Grid.RowDefinitions>
                <ListBox
                 x:Name="listCheck"
                 Grid.Row="0"
                 Margin="5"
                ItemsSource="{Binding ClashTests}"
                 SelectionMode="Extended"
                 DisplayMemberPath="DisplayName"
                 ItemContainerStyle="{StaticResource ListBoxItemStyle}">
                </ListBox>
                <StackPanel Grid.Row="1"
                            Orientation="Horizontal">
                    <Button Content="Выделить все"
                            Margin="5"
                            Command="{Binding ClashTests_SelectAllCommand}"
                            Style="{StaticResource ButtonStyle}">
                    </Button>
                </StackPanel>
            </Grid>
        </GroupBox>
        <GroupBox Header ="Выбор поиска" 
                  Grid.Row="0" 
                  Margin="2">
            <TabControl SelectedIndex="{Binding SelectedTabIndex}">
                <TabItem Header="По наборам">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition/>
                        </Grid.RowDefinitions>
                        <!--ЭЛЕМЕНТ1-->
                        <GroupBox  Grid.Column="0" Margin="1">
                            <GroupBox.Header>
                                <TextBlock Text="{Binding CountSet1Selected, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay, StringFormat='ЭЛЕМЕНТ1: выделено: {0} шт.'}"/>
                            </GroupBox.Header>
                            <TreeView 
                            ItemsSource="{Binding TreeSavedItem1}">
                                <TreeView.ItemTemplate >
                                    <HierarchicalDataTemplate ItemsSource="{Binding Path=Nodes}">
                                        <StackPanel Orientation="Horizontal">
                                            <CheckBox IsChecked="{Binding IsSelected}">
                                                <CheckBox.Style>
                                                    <Style TargetType="{x:Type CheckBox}">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Path=IsGroup}" Value="True">
                                                                <Setter Property="Visibility" Value="Hidden" />
                                                                <Setter Property="Width" Value="0" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </CheckBox.Style>
                                            </CheckBox>
                                            <TextBlock Text="{Binding DisplayName}" />
                                        </StackPanel>

                                    </HierarchicalDataTemplate>
                                </TreeView.ItemTemplate>
                                <TreeView.ItemContainerStyle>
                                    <Style TargetType="TreeViewItem">
                                        <Setter Property="IsExpanded" Value="{Binding IsExpanded}" />
                                    </Style>
                                </TreeView.ItemContainerStyle>
                            </TreeView>
                        </GroupBox>
                        <!--ЭЛЕМЕНТ2-->
                        <GroupBox 
                                  Grid.Column="1"
                                  Margin="1">
                            <GroupBox.Header>
                                <TextBlock Text="{Binding CountSet2Selected, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay, StringFormat='ЭЛЕМЕНТ2: выделено: {0} шт.'}"/>
                            </GroupBox.Header>
                            <TreeView ItemsSource="{Binding TreeSavedItem2}">
                                <TreeView.ItemTemplate >
                                    <HierarchicalDataTemplate ItemsSource="{Binding Path=Nodes}">
                                        <StackPanel Orientation="Horizontal">
                                            <CheckBox IsChecked="{Binding IsSelected}">
                                                <CheckBox.Style>
                                                    <Style TargetType="{x:Type CheckBox}">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Path=IsGroup}" Value="True">
                                                                <Setter Property="Visibility" Value="Hidden" />
                                                                <Setter Property="Width" Value="0" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </CheckBox.Style>
                                            </CheckBox>
                                            <TextBlock Text="{Binding DisplayName}" />
                                        </StackPanel>
                                    </HierarchicalDataTemplate>
                                </TreeView.ItemTemplate>
                                <TreeView.ItemContainerStyle>
                                    <Style TargetType="TreeViewItem">
                                        <Setter Property="IsExpanded" Value="{Binding IsExpanded}" />
                                    </Style>
                                </TreeView.ItemContainerStyle>
                            </TreeView>
                        </GroupBox>

                    </Grid>
                </TabItem>
                <TabItem Header="Другое">
                    <ListBox  
                             Margin="5"
                             ItemsSource="{Binding Checks}"
                             SelectionMode="Extended"
                             DisplayMemberPath="Name"
                             ItemContainerStyle="{StaticResource ListBoxItemStyle}" >
                    </ListBox>
                </TabItem>
            </TabControl>
        </GroupBox>
        <GroupBox Header="Профили"
                  Grid.Row="3"
                  Grid.Column="0"
                  Margin="2">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                </Grid.ColumnDefinitions>
                <ComboBox ItemsSource="{Binding Profiles}"
                          SelectedItem="{Binding SelectedProfile}"
                          DisplayMemberPath="Name"
                          Margin="5"/>

                <Button 
                         Grid.Column="1"
                         Margin="5"
                         Command="{Binding Profile_SetCommand}" Content="Применить" 
                         Style="{StaticResource ButtonStyle}">
                </Button>
                <Button 
                        Grid.Column="2"
                        Margin="5"
                        Command="{Binding Profile_AddCommand}" Content="Добавить профиль" 
                        Style="{StaticResource ButtonStyle}">
                </Button>
                <Button 
                        Grid.Column="3"
                        Margin="5"
                        Command="{Binding Settings_EditCommand}" Content="Редактирование профилей" 
                        Style="{StaticResource ButtonStyle}">
                </Button>

            </Grid>
        </GroupBox>

        <!--ОКНО ВЫВОДА-->
        <GroupBox 
                  Grid.Column="2" 
                  Grid.Row="0" 
                  Grid.RowSpan="4"
                  Margin="2">
            <GroupBox.Header>
                <TextBlock Text="{Binding  CountClashResults, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay, StringFormat='ОКНО ВЫВОДА: всего {0} шт.'}"/>
            </GroupBox.Header>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition Height="35"/>
                    <RowDefinition Height="Auto"/>

                </Grid.RowDefinitions>

                <DataGrid ItemsSource="{Binding ClashResults}"
                          IsSynchronizedWithCurrentItem="True"
                          IsReadOnly="True"
                          Margin="5"
                          AutoGenerateColumns="False"
                          SelectionMode="Extended"
                          KeyboardNavigation.DirectionalNavigation='Contained'>
                    <DataGrid.Resources>
                        <Style TargetType="DataGridRow">
                            <Setter Property="IsSelected"
                                    Value="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" />
                        </Style>
                    </DataGrid.Resources>


                    <DataGrid.InputBindings>
                        <MouseBinding MouseAction ="LeftDoubleClick"
                                     Command="{Binding ClashResults_DoubleClickCommand}"
                                     CommandParameter="{Binding ClashResults/}"/>

                    </DataGrid.InputBindings>
                    <DataGrid.Columns>

                        <DataGridCheckBoxColumn Header="" 
                                    Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                    IsReadOnly="False"
                                    Width="30"/>
                        <DataGridTextColumn Header="Имя проверки" 
                                    Binding="{Binding NameClashTest}"
                                    IsReadOnly="True"
                                    Width="100"/>
                        <DataGridTextColumn Header="Номер конфликта" 
                                    Binding="{Binding Number}"
                                    IsReadOnly="True"
                                    Width="100"/>
                        <DataGridTextColumn Header="Статус"
                                    Binding="{Binding Status}"
                                    IsReadOnly="True"
                                    Width="90"/>
                        <DataGridTextColumn Header="Набор элемента1"
                                    Binding="{Binding CheckItem1}"
                                    IsReadOnly="True"
                                    Width="115"/>
                        <DataGridTextColumn Header="Набор элемента2"
                                    Binding="{Binding CheckItem2}"
                                    IsReadOnly="True"
                                    Width="115"/>
                        <DataGridTextColumn Header="Комментарий"
                                    Binding="{Binding Comments}"
                                    IsReadOnly="True"
                                    Width="60"/>
                    </DataGrid.Columns>
                </DataGrid>
                <StackPanel Grid.Row="1" Orientation="Horizontal">
                    <Button Content="Выделить все"
                            Margin="5"
                            Command="{Binding ClashResults_SelectAllCommand}"
                            Style="{StaticResource ButtonStyle}">
                    </Button>
                    <Button Content="Снять выделение"
                            Margin="5"
                            Command="{Binding ClashResults_UnSelectAllCommand}"
                            Style="{StaticResource ButtonStyle}">
                    </Button>
                    <Button Content=" Экспорт В Excel "
                            Margin="5"
                            Command="{Binding ClashResults_ExportCommand}"
                            Style="{StaticResource ButtonStyle}">
                    </Button>
                </StackPanel>
                <GroupBox Grid.Row="2" 
                          Header="Изменить отмеченные коллизии">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="90"/>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="100"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="35"/>
                            <RowDefinition Height="35"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="Cтатус: "
                                   Grid.Row="0"
                                   Grid.Column="0"
                               Margin="7"
                               VerticalAlignment="Center"/>
                        <TextBlock Text="Комментарий:"
                                   Grid.Row="1"
                                   Grid.Column="0"
                               Margin="7"
                               VerticalAlignment="Center"/>
                        <ComboBox Grid.Row="0"
                                  Grid.Column="1"
                                  Grid.ColumnSpan="2"
                                  ItemsSource="{Binding ClashResultStatusList}"
                                  SelectedItem="{Binding StatusClash}"
                                  Margin="5"/>
                        <ComboBox Grid.Row="1"
                                  Grid.Column="1"
                                  ItemsSource="{Binding CommentStatusList}"
                                  SelectedItem="{Binding StatusComment}"
                                  Margin="5"/>
                        <Border BorderThickness="1" 
                                Grid.Column="2"
                                Grid.Row="2"
                                Margin = "5">
                            <Border.BorderBrush>
                                <LinearGradientBrush StartPoint="0,1" EndPoint="1,0" SpreadMethod="Pad" Opacity="1">
                                    <GradientStop Color="#FF233C91" Offset="0.6" />
                                    <GradientStop Color="#FFB455A0" Offset="1" />
                                </LinearGradientBrush>
                            </Border.BorderBrush>
                            <TextBlock  Grid.Row="1"
                                  Grid.Column="2" 
                                  Margin="3" 
                                  VerticalAlignment="Top"
                                  Text="{Binding Comment, UpdateSourceTrigger=PropertyChanged}">
                                <TextBlock.InputBindings>
                                    <MouseBinding Command="{Binding TextBlock_ClickCommand}" MouseAction="LeftClick" />
                                </TextBlock.InputBindings>
                            </TextBlock>

                        </Border>

                        <Button Content="Применить"
                                Grid.Column="3"
                                Grid.Row="0"
                                Margin="5"
                                Command="{Binding ClashResults_ChangeStatusCommand}"
                                Style="{StaticResource ButtonStyle}">
                        </Button>
                        <Button Content="Добавить"
                                Grid.Column="3"
                                Grid.Row="1"
                                Margin="5"
                                Command="{Binding ClashResults_AddCommentCommand}"
                                Style="{StaticResource ButtonStyle}">
                        </Button>
                    </Grid>
                </GroupBox>
            </Grid>
        </GroupBox>
        <Grid Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Image  HorizontalAlignment="Right" Grid.Column="1">
                <Image.Source>
                    <DrawingImage>
                        <DrawingImage.Drawing>
                            <DrawingGroup ClipGeometry="M0,0 V255.3 H794.4 V0 H0 Z">
                                <DrawingGroup Opacity="1">
                                    <DrawingGroup Opacity="1">
                                        <GeometryDrawing Brush="#FF233C91" Geometry="F1 M794.4,255.3z M0,0z M534.5,127.6C534.5,150.9 553.4,169.7 576.6,169.7 599.9,169.7 618.7,150.8 618.7,127.6 618.7,104.4 599.8,85.5 576.6,85.5 553.3,85.5 534.5,104.4 534.5,127.6 M550.8,127.6C550.8,113.4 562.3,101.8 576.6,101.8 590.8,101.8 602.4,113.3 602.4,127.6 602.4,141.9 590.9,153.4 576.6,153.4 562.3,153.4 550.8,141.9 550.8,127.6 M692.9,85.6L692.9,123.5 692.9,170 709.4,170 709.4,85.7 692.9,85.7z M635,85.6L635,169.9 651.5,169.9 651.5,135.9 686.3,135.9 692.7,119.5 651.6,119.5 651.6,85.5 635,85.5z M478.8,85.6L446,169.9 463.4,169.9 487.7,107.2 512,169.9 529.4,169.9 496.7,85.6 478.8,85.6z M387.2,85.6L354.5,169.9 371.9,169.9 378.3,153.4 401.3,153.4 407.7,137 384.7,137 396.3,107.2 420.6,169.9 438,169.9 405.3,85.6 387.2,85.6z M215.1,98.2L226.6,109.7C231.3,104.9 237.8,101.9 245.1,101.9 259.3,101.9 270.9,113.4 270.9,127.7 270.9,142 259.4,153.5 245.1,153.5 237.9,153.5 231.3,150.5 226.6,145.7L215.1,157.2C222.7,165 233.4,169.8 245.1,169.8 268.4,169.8 287.2,150.9 287.2,127.7 287.2,104.5 268.3,85.6 245.1,85.6 233.4,85.6 222.8,90.4 215.1,98.2 M295.4,85.6L295.4,101.9 316.8,101.9 316.8,169.9 333.1,169.9 333.1,101.9 354.4,101.9 354.4,85.6 295.4,85.6z M234.6,119.6L234.8,136 262.4,136 268.8,119.6 234.6,119.6z" />
                                    </DrawingGroup>
                                    <GeometryDrawing Geometry="F1 M794.4,255.3z M0,0z M85,170.3L154.9,170.3 161.3,153.8 85,153.8 85,170.3z M85,85L85,101.5 181.5,101.5 188,85 85,85z M112.9,135.9L168.2,135.9 174.6,119.4 112.9,119.4 112.9,135.9z">
                                        <GeometryDrawing.Brush>
                                            <LinearGradientBrush StartPoint="81.201,166.4183" EndPoint="175.2652,72.3542" MappingMode="Absolute" SpreadMethod="Pad" Opacity="1">
                                                <GradientStop Color="#FF233C91" Offset="0.6" />
                                                <GradientStop Color="#FFB455A0" Offset="1" />
                                            </LinearGradientBrush>
                                        </GeometryDrawing.Brush>
                                    </GeometryDrawing>
                                </DrawingGroup>
                            </DrawingGroup>
                        </DrawingImage.Drawing>
                    </DrawingImage>
                </Image.Source>
            </Image>

            <Button 
                Grid.Column="1"
                Margin="5"
                Width="350"
                Command="{Binding SearchCommand}" Content="Поиск коллизий" 
                Style="{StaticResource ButtonStyle}" FontSize="16">
            </Button>
            <Button 
                Grid.Column="0"
                Margin="5"
                Width="350"
                Command="{Binding ReloadCommand}" Content="Обновить проверки и наборы" 
                Style="{StaticResource ButtonStyle}" FontSize="16">
            </Button>
        </Grid>
    </Grid>
</Window>
